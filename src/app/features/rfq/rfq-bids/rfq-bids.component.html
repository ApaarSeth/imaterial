<div class="page-start-point">
  <div class="p-l-20 p-r-20 p-b-20 min-height parent">
    <form *ngIf="rfqProjects.length" (ngSubmit)="allocateQuantity()" [formGroup]="rfqForms">
      <div class="row p-t-10 p-b-10">
        <div class="col-sm-12">
          <span>
            <button
              mat-raised-button
              class="main-background-color main-button color-white pull-right"
              [disabled]="getFormValidation() ? (getFormQtyValidation() ? true : false) : true"
            >
              Create P.O
            </button>
          </span>
          <div class="pull-right color-main p-r-20 p-t-10 text-semi-bold cursor-pointer" (click)="viewRemarks()">
            View Remarks
          </div>
        </div>
      </div>

      <div class="col-xs-12 p-t-10 p-b-20 text-right" *ngIf="rfqProjects[0].rfqCurrency != null && rfqProjects[0].rfqCurrency.exchangeCurrencyName != null">
        <span class="slideToggalColor p-r-10"><mat-slide-toggle [(ngModel)]="ratesBaseCurr" [ngModelOptions]="{standalone: true}"></mat-slide-toggle></span>
        <span class="base-currency p-l-5 p-r-5 p-t-10 p-b-10">
          <span class="font-size-vary-grn color-grey">
            <img width="25px" *ngIf="rfqProjects[0].rfqCurrency.exchangeCurrencyFlag" [src]="rfqProjects[0].rfqCurrency.exchangeCurrencyFlag" />
            {{ rfqProjects[0].rfqCurrency.exchangeCurrencyName }}
          </span>
          <span class="p-l-5"> = </span>
          <span class="p-l-5 color-6d6a6a color-grey"> {{ rfqProjects[0].rfqCurrency.exchangeValue }} </span>
          <span class="p-l-5 color-grey">
            <img width="25px" *ngIf="rfqProjects[0].rfqCurrency.primaryCurrencyFlag" [src]="rfqProjects[0].rfqCurrency.primaryCurrencyFlag" />
            {{ rfqProjects[0].rfqCurrency.primaryCurrencyName }}
          </span>
        </span>
      </div>
      <div formArrayName="forms">
        <div class="customBid">
          <div *ngFor="let project of rfqProjects; let p = index" [formGroupName]="p">
            <mat-accordion displayMode="flat" multi class="mat-table">
              <mat-expansion-panel class="mat-expansion-panel-body" class="myPanel" [expanded]="true">
                <mat-expansion-panel-header class="">
                  <span class="top-header-area">
                    <span class="project-name mr-5">{{ project.projectName }}</span>
                    <span class="main-color"
                      >{{ project.addressLine1 }} {{ project.addressLine2 }} {{ project.city }} {{ project.pinCode }} {{ project.state }} {{ project.country }}
                    </span>
                  </span>
                </mat-expansion-panel-header>

                <!--table class="table">
                  <tr>
                    <th>Material Name</th>
                    <th>Quantity</th>
                    <th>Makes & Rates</th>
                  </tr>

                  <ng-container formArrayName="materialList">
                    <ng-container *ngFor="let material of project.materialList; let m = index" [formGroupName]="m">
                      <tr>
                        <td>{{ material.materialName }}</td>
                        <td>{{ material.rfqMaterialQty }}</td>
                        <td>
                          <ng-container *ngFor="let brand of material.brandNames">
                            <span class="col-xs-1">
                              {{ brand }}
                            </span>
                            <span class="col-xs-1">
                              Supplier Rates
                            </span>
                          </ng-container>
                        </td>
                      </tr>
                    </ng-container>
                  </ng-container>
                  
                </table-->

                <div>
                  <section class="mat-header-row">
                    <span class="mat-cell maxwidth-15 p-l-25">Material Name</span>
                    <span class="mat-cell maxwidth-10">Quantity</span>
                    <span class="mat-cell maxwidth-15">Makes & Rates</span>
                  </section>
                </div>

                <ng-container formArrayName="materialList">
                  <div class="p-0" *ngFor="let material of project.materialList; let m = index" [formGroupName]="m">
                    <section class="mat-row rfqbid-header-color">
                      <span class="mat-cell maxwidth-15 p-l-25">
                        <div class="limited-character" matTooltip=" {{ material.materialName }}">
                          {{ material.materialName }} <br />
                          <!-- <span *ngIf="!rfqForms.controls.forms['controls'][p].controls.materialList.controls[m].controls.validQtyBoolean.value" class="error-msg font-size9"> Net Quantity Should be less than {{material.poAvailableQty}} </span> -->
                        </div>
                      </span>
                      <span class="mat-cell maxwidth-10">
                        {{ material.rfqMaterialQty }}
                        <span class="p-l-5">{{ material.materialUnit }}</span>
                      </span>

                      <span class="mat-cell maxwidth-75">
                        <div class="mat-row align-items-center">
                          <ng-container *ngFor="let brand of material.brandNames">
                            <span class="mat-cell maxwidth-10 text-center">
                              {{ brand }}
                            </span>
                            <span class="mat-cell maxwidth-10 text-left">
                              Supplier Rates
                              <span *ngIf="this.rfqProjects[0].rfqCurrency" class="p-r-5 p-t-2">({{ currency }})</span>
                            </span>

                            <!-- <span class="col-sm-1"></span> -->
                          </ng-container>
                        </div>
                      </span>
                    </section>

                    <ng-container formArrayName="supplierList">
                      <div class="mat-row supplierLevel" *ngFor="let supplier of material.supplierList; let s = index" [formGroupName]="s">
                        <span class="mat-cell maxwidth-15 p-l-25 limited-character" matTooltip=" {{ supplier.supplierName }}">{{ supplier.supplierName }} </span>
                        <span class="mat-cell maxwidth-10"></span>

                        <div class="mat-cell maxwidth-75">
                          <div class="row align-items-center">
                            <ng-container formArrayName="brandGroup">
                              <ng-container *ngFor="let brandInfo of supplier.brandDetailList; let i = index" [formGroupName]="i">
                                <span class="mat-cell maxwidth-10 text-center">
                                  <ng-container *ngIf="brandInfo.materialUnitPrice !== null && brandInfo.materialUnitPrice !== 0; else dashedLine">
                                    <mat-form-field class="border-input">
                                      <input
                                        type="text"
                                        class="quantity"
                                        appTwoDigitDecimaNumber
                                        matInput
                                        formControlName="quantity"
                                        placeholder="qty"
                                        min="0"
                                        (input)="getQuanityValidation(p, m)"
                                      />
                                    </mat-form-field>
                                  </ng-container>

                                  <ng-template #dashedLine>
                                    <span>--</span>
                                  </ng-template>
                                </span>

                                <span class="mat-cell maxwidth-20 text-center">
                                  {{
                                    brandInfo.materialUnitPrice != null
                                      ? ratesBaseCurr
                                        ? (brandInfo.materialUnitPrice * project.rfqCurrency.exchangeValue | number: "1.2-2")
                                        : (brandInfo.materialUnitPrice | number: "1.2-2")
                                      : "--"
                                  }}
                                </span>

                                <!-- <span class="col-sm-1"></span> -->
                              </ng-container>
                            </ng-container>
                          </div>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                </ng-container>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
