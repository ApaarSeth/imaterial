<form *ngIf="allProjects" [formGroup]="form">
  <div class="row">
    <div class="col-xs-4 p-t-10 border-input">
      <mat-form-field class="input-search-padding-zero">
        <input matInput placeholder="Search Projects" type="search" [(ngModel)]="searchProject" [ngModelOptions]="{standalone: true}" />
        <button mat-button matSuffix mat-icon-button>
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field class="p-l-20 input-search-padding-zero">
        <input matInput placeholder="Search Material" type="search" [(ngModel)]="searchMaterial" [ngModelOptions]="{standalone: true}" />
        <button mat-button matSuffix mat-icon-button>
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="col-xs-4 text-right">
      <mat-form-field class="border-select select-project">
        <mat-label *ngIf="!rfqDetails.length">Select Project</mat-label>
        <mat-select formControlName="selectedProject" multiple>
          <div class="display-flex">
            <input class="p-l-10 p-b-5" matInput type="search" placeholder="Search project Name" [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}" />
            <button mat-button matSuffix mat-icon-button>
              <mat-icon>search</mat-icon>
            </button>
          </div>
          <mat-select-trigger>
            <mat-label>Select Project</mat-label>
          </mat-select-trigger>
          <mat-option *ngFor="let project of allProjects | SearchPipe: searchText:'projectName'" [value]="project" selected="project.clicked" (click)="choosenProject()"
            >{{ project.projectName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-xs-4 text-right">
      <span>
        <button mat-raised-button matStepperNext [disabled]="!(form.valid && counter > 0)" (click)="materialAdded()" class="main-background-color main-button color-white">
          Next
        </button>
      </span>
    </div>
  </div>
</form>
<form *ngIf="rfqDetails.length" [formGroup]="materialForm">
  <span formArrayName="forms">
    <div *ngFor="let project of rfqDetails | SearchPipe: searchProject:'projectName'; let p = index" [formGroupName]="p">
      <mat-accordion *ngIf="rfqDetails && project.projectMaterialList.length" class="rfq-detail-body">
        <mat-expansion-panel class="myPanel" [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ project.projectName }}

              <a href="javascript:void(0)" class="main-color p-l-15">
                {{ project.defaultAddress.addressLine1 }}
                <ng-container *ngIf="project.defaultAddress.addressLine2"> {{ project.defaultAddress.addressLine2 }}</ng-container>
                <ng-container *ngIf="project.defaultAddress.city"> {{ project.defaultAddress.city }}</ng-container>
                <ng-container *ngIf="project.defaultAddress.state"> {{ project.defaultAddress.state }}</ng-container>
                <ng-container *ngIf="project.defaultAddress.pinCode"> {{ project.defaultAddress.pinCode }}</ng-container>
              </a>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <table
            mat-table
            [dataSource]="project.projectMaterialList | SearchPipe: searchMaterial:'materialName'"
            class="mat-elevation-z8 col-sm-12 po-custom-mat-width"
            formArrayName="materialList"
          >
            <ng-container matColumnDef="Material Name">
              <th mat-header-cell *matHeaderCellDef>Material Name</th>
              <td mat-cell *matCellDef="let element; let i = index" formGroupName="{{ i }}">
                <mat-checkbox #ch [checked]="element.checked" (change)="materialChecked(ch, i, p, project.projectId, element)">
                  <div class="limited-character po-p-m" matTooltip=" {{ element.materialName }}">{{ element.materialName }} <br /></div>
                  <div class="limited-character po-p-m" matTooltip=" {{ element.materialGroup }}">
                    <span class="category-name">
                      {{ element.materialGroup }}
                    </span>
                  </div>
                </mat-checkbox>
              </td>
            </ng-container>
            <ng-container matColumnDef="Required Date">
              <th mat-header-cell class="text-center" *matHeaderCellDef>Required Date</th>
              <td class="text-center" mat-cell *matCellDef="let element; let i = index">
                {{ element.dueDate | date: "dd-MMM-yyy" }}
              </td>
            </ng-container>
            <ng-container matColumnDef="Requested Quantity">
              <th mat-header-cell class="text-center" *matHeaderCellDef>Requested Quantity</th>
              <td class="text-center" mat-cell *matCellDef="let element">
                {{ element.requestedQty }}<span class="p-l-5">{{ element.materialUnit }}</span>
              </td>
            </ng-container>
            <ng-container matColumnDef="Estimated Quantity">
              <th mat-header-cell class="text-center" *matHeaderCellDef>Estimated Quantity</th>
              <td class="text-center" mat-cell *matCellDef="let element">
                {{ element.estimatedQty }}<span class="p-l-5">{{ element.materialUnit }}</span>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </mat-expansion-panel>
        <br />
      </mat-accordion>
    </div>
  </span>
</form>
