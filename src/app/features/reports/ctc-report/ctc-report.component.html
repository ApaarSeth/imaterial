<div class="page-start-point changeWidth mt-5 pt-4 ctc-report">
  <form *ngIf="allProjects" [formGroup]="form">
    <div class="row" class="users-dashboard p-b-20 min-height parent report">
      <!-- In case of WEB View - design for search Projects, Generate Report and amount  -->
      <div class="row align-items-center mt-2">

        <!------ Select Project Field ------>
        <div class="col-md-3 text-left showResponsiveReport">
          <mat-form-field class="border-select select-project-dropdown w-100">
            <mat-label>Select Project</mat-label>
            <mat-select formControlName="selectedProject" multiple>
              <div class="search-project-div d-flex align-items-center">
                <input class="p-b-5" matInput type="Search Project..." placeholder="Search project Name"
                  [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}" (keydown)="$event.stopPropagation()"
                  autocomplete="off" />
                <button mat-button matSuffix mat-icon-button>
                  <mat-icon>search</mat-icon>
                </button>
              </div>
              <mat-option *ngFor="let project of allProjectsList | SearchPipe: searchText:['projectName']"
                [value]="project.projectId" selected="project.clicked" (click)="getProjectMaterials()">
                {{project.projectName}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-md-9 add-project-btn display-flex justify-content-flex-end align-items-center">
          <!------ Download Report ------>
          <div class="download-report pr-3">
            <a class="font-size16 cursor-pointer" matTooltip="Download"> <img
                src="../../../../assets/images/download-po.png" /></a>
          </div>

          <!------ Generate Report (will use later) ------>
          <!-- <button mat-raised-button class="main-background-color main-button color-white demo-title cursor-pointer">
            Generate Report
          </button> -->


          <!------ Show Amount Field ------>
          <div *ngIf="allProjectsData" class="show-amount-dropdown text-semi-bold main-color font-size-vary-grn cursor-pointer" #triggerBtn [matMenuTriggerFor]="amount">
            show amount
          </div>
        </div>

        <!-- <div class="col-md-12 add-project-btn display-flex justify-content-flex-end showResponsiveReport">
          <div class="show-amount text-semi-bold main-color font-size-vary-grn cursor-pointer" #triggerBtn
            [matMenuTriggerFor]="amount">
            show amount
          </div>
        </div> -->
      </div>

      <div class="row justify-content-flex-end">
        <div class="col-md-12">
          <!-- mat-menu that opens up after we click show-amount   -->
          <mat-menu #amount="matMenu" class="header-project-menu show-amount">
            <button mat-menu-item *ngFor="let range of amountRange" (click)="clickMenuItem(range)">
              {{ range }}
            </button>
          </mat-menu>
        </div>
      </div>

      <!-- table For Showing Reports-->
      <ng-container *ngIf="allProjectsData?.length; else noDataAvailable">
        <div class="reportTablePo">
          <p class="fontsize-14-px p-b-0 p-t-10 mb-2">*Conversion Rate = {{ currency }}</p>
          <table class="report-table">
            <tr matSort class="mat-elevation-z2 mat-header-row ctc-report-header-row">
              <th class="mat-header-cell material">Materials</th>
              <th class="mat-header-cell material">Unit</th>
              <th class="mat-header-cell material">Estimated Amount <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
              <th class="mat-header-cell material">Awarded Amount <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
              <th class="mat-header-cell material">Delivered Amount <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
              <th class="mat-header-cell material">Paid Amount <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
              <th class="mat-header-cell material">Projected Cost <br/>to Complete <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
              <th class="mat-header-cell material">Balance Cost <br/>to Complete <br/>
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span>{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </th>
            </tr>
            
            <mat-accordion *ngFor="let project of allProjectsData">
              <!-- Project List Data -->
              <mat-expansion-panel>
                <mat-expansion-panel-header class="border-row background-projects">
                  <tr class="material-row backgound-none-important p-r-10">
                    <td class="mat-cell">{{ project.projectName }}</td>
                    <td class="mat-cell"></td>
                    <td class="mat-cell">{{ project.estimatedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ project.awardedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ project.deliveredAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ project.paidAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ project.projectedCost / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ (project.projectedCost - project.deliveredAmount) / this.conversionNumber | number: "1.2-2" }}</td>
                  </tr>
                </mat-expansion-panel-header>

                <!-- Material category details of specific project -->
                <mat-expansion-panel *ngFor="let matCategory of project.materialCategoryDataList">
                  <mat-expansion-panel-header class="border-row background-category">
                    <tr class="material-row p-r-10">
                      <td class="mat-cell">{{ matCategory.materialCategoryName }}</td>
                      <td class="mat-cell">{{ matCategory.materialUnit }}</td>
                      <td class="mat-cell">{{ matCategory.estimatedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ matCategory.awardedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ matCategory.deliveredAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell"></td>
                      <td class="mat-cell">{{ matCategory.projectedCost / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ (matCategory.projectedCost - matCategory.deliveredAmount) / this.conversionNumber | number: "1.2-2" }}</td>
                    </tr>
                  </mat-expansion-panel-header>

                  <!-- material details of specific material category -->
                  <tr class="material-row border-row background-project-list" *ngFor="let material of matCategory.materialCTCDataList">
                    <td class="mat-cell">{{ material.materialName }}</td>
                      <td class="mat-cell">{{ material.materialUnit }}</td>
                      <td class="mat-cell">{{ material.estimatedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ material.awardedAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ material.deliveredAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell"></td>
                      <td class="mat-cell">{{ material.projectedCTC / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ (material.projectedCTC - material.deliveredAmount) / this.conversionNumber | number: "1.2-2" }}</td>
                  </tr>
                </mat-expansion-panel>
              </mat-expansion-panel>
            </mat-accordion>
          </table>
        </div>
      </ng-container>

      <!-- Report Default Image If No data is Present -->
      <ng-template #noDataAvailable>
        <div class="wrapper-btn-center">
          <div class="report-image">
            <img src="../../../../assets/images/report-main.svg" alt="BuildSupply_Logo" />
            <div>
              <p class="p-t-10 font-size-vary-grn">
                You have not selected any project yet. <br />
                Please select any one from the above to see the report.
              </p>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </form>
</div>