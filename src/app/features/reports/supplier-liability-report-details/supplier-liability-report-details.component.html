<div class="page-start-point changeWidth mt-5 pt-4">
  <form *ngIf="allProjects" [formGroup]="form" autocomplete="off">
    <div class="row" class="users-dashboard p-b-20 min-height parent report">
      <!-- In case of WEB View - design for search Projects, Supplier, Generate Report and amount  -->
      <div class="row">
        <div class="col-xs-4 col-sm-4 col-md-3 text-left showResponsiveReport column-1">
          <mat-form-field class="border-select select-project width100Percent font-size-vary-grn">
            <mat-label>Select Project</mat-label>
            <mat-select formControlName="selectedProject" multiple>
              <div class="display-flex">
                <input
                  class="p-l-10 p-b-5"
                  matInput
                  type="search"
                  placeholder="Search project Name"
                  [(ngModel)]="searchProject"
                  [ngModelOptions]="{standalone: true}"
                  (keydown)="$event.stopPropagation()"
                />
                <button mat-button matSuffix mat-icon-button>
                  <mat-icon>search</mat-icon>
                </button>
              </div>
              <!-- <mat-select-trigger>
                    <mat-label>Select Project</mat-label>
                  </mat-select-trigger> -->
              <mat-option *ngFor="let project of allProjects | SearchPipe: searchProject:['projectName']" [value]="project" selected="project.clicked" (click)="choosenProject()"
                >{{ project.projectName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-xs-5 col-sm-4 col-md-3 text-left showResponsiveReport column-2">
          <mat-form-field class="border-select select-project width100Percent font-size-vary-grn">
            <mat-label>Select Supplier</mat-label>
            <mat-select formControlName="selectedSupplier" multiple>
              <div class="display-flex">
                <input
                  class="p-l-10 p-b-5"
                  matInput
                  type="search"
                  placeholder="Search Supplier Name"
                  [(ngModel)]="searchSupplier"
                  [ngModelOptions]="{standalone: true}"
                  (keydown)="$event.stopPropagation()"
                />
                <button mat-button matSuffix mat-icon-button>
                  <mat-icon>search</mat-icon>
                </button>
              </div>
              <!-- <mat-select-trigger>
                    <mat-label>Select Supplier</mat-label>
                  </mat-select-trigger> -->
              <mat-option
                *ngFor="let supplier of allSuppliers | SearchPipe: searchSupplier:['supplier_name']"
                [value]="supplier"
                selected="supplier.clicked"
                (click)="choosenSupplier()"
                >{{ supplier.supplier_name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-xs-12 col-sm-4 col-md-6 p-t-10 add-project-btn display-flex justify-content-flex-end column-3">
          <div *ngIf="projectIds.length || supplierIds.length" class="p-r-20 p-t-10">
            <a class="font-size16 cursor-pointer" matTooltip="Download"> <img src="../../../../assets/images/download-po.png" /> </a>
          </div>
          <div *ngIf="supplierLiabiltyReportData" class="show-amount p-r-12 text-semi-bold main-color font-size-vary-grn cursor-pointer" #triggerBtn [matMenuTriggerFor]="amount">
            Show amount
          </div>
          <!-- <button mat-raised-button class="main-background-color main-button color-white demo-title cursor-pointer">
            Generate Report
          </button> -->
        </div>
        <div *ngIf="supplierLiabiltyReportData" class="col-xs-3 col-sm-12 add-project-btn display-flex justify-content-flex-end showResponsiveReport column-4"></div>
      </div>

      <!-- mat-menu that opens up after we click show-amount   -->
      <mat-menu #amount="matMenu" class="header-project-menu show-amount">
        <button mat-menu-item class="height-30-px m-b-5 line-0-px" *ngFor="let range of amountRange" (click)="clickMenuItem(range)">
          {{ range }}
        </button>
      </mat-menu>

      <!-- Report Default Image If No data is Present -->
      <ng-container *ngIf="!supplierLiabiltyReportData">
        <div class="wrapper-btn-center">
          <div class="report-image">
            <img src="../../../../assets/images/report-main.svg" alt="BuildSupply_Logo" />
            <div>
              <p class="p-t-10 font-size-vary-grn">
                You have not selected any project or supplier yet. <br />
                Please select any one from the above to see the report.
              </p>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- table For Showing Reports-->

      <ng-container *ngIf="supplierLiabiltyReportData">
        <div class="reportTablePo" *ngIf="supplierLiabiltyReportData.supplierReportDataList; else elseBlock">
          <p class="fontsize-14-px p-b-0 p-t-10 m-b-0">*Conversion Rate={{ currency }}</p>

          <table class="report-table">
            <tr matSort class="mat-elevation-z2 mat-header-row">
              <thead class="mat-header-cell material">
                Supplier Name
              </thead>
              <thead class="mat-header-cell material">
                PO Awarded
                <br />
                Value
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span
                >{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </thead>
              <thead class="mat-header-cell material">
                GRN Amount
                <br /><span *ngIf="selectedMenu !== 'Full Figures'">(</span
                >{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </thead>
              <thead class="mat-header-cell material">
                Amount Paid
                <br />
                till date
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span
                >{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </thead>
              <thead class="mat-header-cell material">
                Yet to be
                <br />
                paid
                <span *ngIf="selectedMenu !== 'Full Figures'">(</span
                >{{
                  selectedMenu === "Full Figures" ? "" : selectedMenu
                }}<span *ngIf="selectedMenu !== 'Full Figures'">)</span>
              </thead>
            </tr>
            <mat-accordion *ngFor="let supplier of supplierLiabiltyReportData.supplierReportDataList">
              <!-- Supplier List -->
              <mat-expansion-panel>
                <mat-expansion-panel-header class="border-row background-supplier">
                  <tr class="material-row backgound-none-important p-r-10">
                    <td class="mat-cell">{{ supplier.supplierName }}</td>
                    <td class="mat-cell">{{ supplier.totalPoAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ supplier.grnAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ supplier.paymentRecived / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ (supplier.totalPoAmount - supplier.paymentRecived) / this.conversionNumber | number: "1.2-2" }}</td>
                  </tr>
                </mat-expansion-panel-header>
                <!-- Project List -->
                <mat-expansion-panel *ngFor="let project of supplier.projectReportDataList">
                  <mat-expansion-panel-header class="border-row background-project">
                    <tr class="material-row backgound-none-important p-r-10">
                      <td class="mat-cell">{{ project.projectName }}</td>
                      <td class="mat-cell">{{ project.totalPoAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ project.grnAmount / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ project.paymentRecived / this.conversionNumber | number: "1.2-2" }}</td>
                      <td class="mat-cell">{{ (project.totalPoAmount - project.paymentRecived) / this.conversionNumber | number: "1.2-2" }}</td>
                    </tr>
                  </mat-expansion-panel-header>
                  <!-- Project Details Of an Individual Project -->
                  <tr class="material-row border-row background-project-list" *ngFor="let poData of project.entityDataList">
                    <td class="mat-cell">{{ poData.entityLabel }}</td>
                    <td class="mat-cell">{{ poData.totalPoAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ poData.grnAmount / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ poData.paymentRecived / this.conversionNumber | number: "1.2-2" }}</td>
                    <td class="mat-cell">{{ (poData.totalPoAmount - poData.paymentRecived) / this.conversionNumber | number: "1.2-2" }}</td>
                  </tr>
                </mat-expansion-panel>
              </mat-expansion-panel>
            </mat-accordion>
            <!-- Total Amount Footer -->
            <tr class="material-row backgound-total-amount">
              <td class="mat-cell">Total Amount</td>
              <td class="mat-cell">{{ supplierLiabiltyReportData.totalPoAmount / this.conversionNumber | number: "1.2-2" }}</td>
              <td class="mat-cell">{{ supplierLiabiltyReportData.grnAmount / this.conversionNumber | number: "1.2-2" }}</td>
              <td class="mat-cell">{{ supplierLiabiltyReportData.paymentRecived / this.conversionNumber | number: "1.2-2" }}</td>
              <td class="mat-cell">{{ (supplierLiabiltyReportData.totalPoAmount - supplierLiabiltyReportData.paymentRecived) / this.conversionNumber | number: "1.2-2" }}</td>
            </tr>
          </table>
        </div>
        <ng-template #elseBlock>
          <div class="center-element font-16-px">
            No purchase order raised for this project
          </div>
        </ng-template>
      </ng-container>
    </div>
  </form>
</div>
