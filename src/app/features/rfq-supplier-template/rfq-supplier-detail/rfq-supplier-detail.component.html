<!-- <fix-header></fix-header> -->
<div *ngIf="rfqSupplierDetailList" class="rfq-after-bid">
  <div class="p-l-20 p-r-20 p-b-20 min-height parent">
    <div class="row width-100">
      <div class="col-md-12">
        <div class="row p-b-10">
          <div class="col-md-6 col-sm-6 col-xs-12 p-t-10">
            <div>
              <label for="validity" class="pull-left p-t-20 p-r-10">Quote Valid till</label>

              <mat-form-field class="border-input">
                <!-- <span class="form-placeholder">{{ dateDue | date: "dd-MMM-yyy" }}</span> -->
                <input matInput #quote (dateChange)="duedatefunc($event, quote.value)" [matDatepicker]="quoteValidTill"
                  placeholder="Quote Valid till" [(ngModel)]="rfqSupplierDetailList.quoteValidTill"
                  (click)="quoteValidTill.open()" readonly [min]="rfqSupplierDetailList.dueDate" required />

                <mat-datepicker-toggle matSuffix [for]="quoteValidTill"></mat-datepicker-toggle>

                <mat-datepicker #quoteValidTill startView="month" (keyup)="valueChange(rfqSupplierDetailList)">
                </mat-datepicker>
                <!-- startView="month" [startAt]="dueDate" -->
              </mat-form-field>
            </div>
            <div *ngIf="showDateError != '' && showDateError != null">
              <small class="error-msg white-space-nowrap p-l-10">{{ showDateError }}</small>
            </div>
          </div>

          <!-- <div class="col-md-5 col-xs-8 p-t-10">
            <label for="bidCompletion" class="pull-left p-t-20 p-r-10">Bid Completion:</label>
            <span class="pull-left text-semi-bold m-t-20">{{ brandCount }}/{{ materialCount }}</span>

            <span class="pull-right text-semi-bold m-t-20"> RFQ Expiry Date :: {{ rfqSupplierDetailList.dueDate | date: "dd-MMM-yyy" }} </span>
          </div> -->

          <div class="col-md-6 col-sm-6 col-xs-12 p-t-20">
            <span class="pull-right text-semi-bold m-t-20"> RFQ Expiry Date ::
              {{ rfqSupplierDetailList.dueDate | date: "dd-MMM-yyy" }} </span>
            <!-- <button
              mat-raised-button
              [disabled]="!submitButtonValidationFlag"
              class="main-background-color main-button color-white pull-right"
              (click)="postRFQDetailSupplier(rfqSupplierDetailList)"
            >
              Next
            </button> -->
          </div>
        </div>

        <div class="material-rfq-supplies p-15 p-l-30 font-bold">
          <span>
            Payment Details :
          </span>
          <span
            *ngIf="rfqSupplierDetailList && rfqSupplierDetailList.terms && rfqSupplierDetailList.terms.otherDesc === null && rfqSupplierDetailList.terms.termsDesc != null"
            class="p-l-20">
            {{ rfqSupplierDetailList.terms.termsDesc }}
          </span>
          <span
            *ngIf="rfqSupplierDetailList && rfqSupplierDetailList.terms && rfqSupplierDetailList.terms.otherDesc != null"
            class="p-l-20">
            {{ rfqSupplierDetailList.terms.otherDesc }}
          </span>
          <span
            *ngIf="rfqSupplierDetailList && rfqSupplierDetailList.terms && rfqSupplierDetailList.terms.otherDesc === null && rfqSupplierDetailList.terms.termsDesc === null"
            class="p-l-20">
            -
          </span>

          <ng-container *ngIf="rfqSupplierDetailList.isInternational === 1">
            <div class="float-right d-inline-block">
              <span class="base-currency pl-3 pr-3 border-dark p-t-10 p-b-10">
                <span class="font-size-vary-grn color-grey">
                  <img width="25px" *ngIf="rfqSupplierDetailList.rfqCurrency.exchangeCurrencyFlag"
                    [src]="rfqSupplierDetailList.rfqCurrency.exchangeCurrencyFlag" />
                  {{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }}
                </span>
                <span class="p-l-5"> = </span>
                <span class="p-l-5 color-6d6a6a color-grey"> {{ rfqSupplierDetailList.rfqCurrency.exchangeValue }}
                </span>
                <span class="p-l-5 color-grey">
                  <img width="25px" *ngIf="rfqSupplierDetailList.rfqCurrency.primaryCurrencyFlag"
                    [src]="rfqSupplierDetailList.rfqCurrency.primaryCurrencyFlag" />
                  {{ rfqSupplierDetailList.rfqCurrency.primaryCurrencyName }}
                </span>
              </span>
            </div>
          </ng-container>

        </div>

        <div style="width: 100%; overflow-x: scroll;">
          <table class="table rfq-bids-table" *ngFor="let projects of rfqSupplierDetailList.projectList">
            <!-- Project Name Header -->
            <tr class="blue-background-color color-white">
              <th class="font-size18 limited-character">
                <span>
                  {{ projects.projectName }}
                </span>
              </th>

              <th class="font-size14" colspan="2">
                <span *ngIf="projects.addressLine1">
                  {{ projects.addressLine1 }}
                </span>
                <span *ngIf="projects.addressLine2"> , {{ projects.addressLine2 }} </span>
                <span *ngIf="projects.city"> , {{ projects.city }} </span>
                <span *ngIf="projects.state"> , {{ projects.state }} </span>
                <span *ngIf="projects.pinCode"> , {{ projects.pinCode }} </span>
              </th>

              <th class="white-radiobutton">
                <mat-radio-group aria-label="Select GST" class="pull-right" [(ngModel)]="projects.gst"
                  (change)="radioChange($event, projects)" *ngIf="rfqSupplierDetailList.isInternational === 0">
                  <mat-radio-button class="p-r-20" value="IGST">IGST</mat-radio-button>
                  <mat-radio-button value="CGST-SGST">CGST & SGST</mat-radio-button>
                </mat-radio-group>
              </th>

              <ng-container *ngIf="rfqSupplierDetailList.isInternational === 1">
                <th></th>
              </ng-container>

            </tr>

            <!-- Material Info -->
            <ng-container *ngFor="let material of projects.materialList">
              <tr matSort class="material-rfq-supplies">
                <td class="font-size14 limited-character">
                  <span>
                    {{ material.materialName }}
                  </span>
                </td>
                <td class="font-size14">
                  Requested Quantity: {{ material.materialQuantity }}
                  {{ material.materialUnit }}
                </td>
                <td class="font-size14">Required Date : {{ material.fullfilmentDate | date: "dd-MMM-yyy" }}</td>
                <ng-container
                  *ngIf="rfqSupplierDetailList.rfqCurrency && rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName">
                  <td class="font-size14">
                    <ng-container
                      *ngIf="taxAndCostData && taxAndCostData[projects.projectId] && taxAndCostData[projects.projectId][material.materialId] && taxAndCostData[projects.projectId][material.materialId].otherCostInfo && taxAndCostData[projects.projectId][material.materialId].otherCostInfo.length">
                      <strong>Other Cost: </strong> <span style="margin-right:5px;"
                        *ngIf="taxAndCostData && taxAndCostData[projects.projectId] && taxAndCostData[projects.projectId][material.materialId] && taxAndCostData[projects.projectId][material.materialId].otherCostInfo.length">{{ getotherCostInfoTotal(taxAndCostData[projects.projectId][material.materialId].otherCostInfo) }}
                        {{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }}</span>
                      <span class="info-icon info-tootip"><img src="./../../../../assets/images/i_icon.png"
                          class="img-responsive">
                        <span class="info-tootip__content">
                          <div class="tooltip-table">
                            <p class="row mb-1"
                              *ngFor="let otcost of taxAndCostData[projects.projectId][material.materialId].otherCostInfo">
                              <strong class="col">{{otcost.otherCostName}}</strong><span
                                class="col">{{otcost.otherCostAmount}}</span>
                            </p>
                          </div>
                        </span>
                      </span>
                    </ng-container>
                  </td>
                </ng-container>
                <td class="text-align-right" [ngClass]="rfqSupplierDetailList.isInternational === 1 ? 'pt-1' : '' ">
                  <ng-container *ngIf="rfqSupplierDetailList.isInternational === 0; else txBtn">
                    <mat-form-field class="border-input">
                      <input matInput type="text" title="" placeholder="GST %" [(ngModel)]="material.Igst" min="0"
                        appTwoDigitDecimaNumber (keyup)="valueChange(rfqSupplierDetailList)" />
                    </mat-form-field>
                    <div class="d-flex justify-content-center" style="padding-left: 50px !important;">
                      <small *ngIf="!material.validGst" class="error-msg">Enter Valid GST%</small>
                    </div>
                  </ng-container>
                  <ng-template #txBtn>
                    <button mat-button matRipple class="btn btn-link p-0 main-color text-decoration-underline"
                      (click)="openTaxesCostsDialog('texesAndCost', projects.projectId, material.materialId)">Add
                      Taxes
                      & costs</button>
                  </ng-template>
                </td>
              </tr>

              <!-- Brand Header for GST-->
              <ng-container *ngIf="rfqSupplierDetailList.isInternational === 0; else intBHeader">
                <tr matSort class="brand-name-rfq-supplies">
                  <th class="font-size14">Brand Name</th>
                  <th class="font-size14">Rate</th>
                  <th class="font-size14 text-align-right">Total Amount (₹)</th>
                  <th class="font-size14 text-align-right">GST Amount (₹)</th>
                </tr>

                <!-- Brand-wise details -->
                <tr class="table-white-background-color" *ngFor="let brand of material.rfqBrandList">
                  <td>{{ brand.brandName }}</td>

                  <td>
                    <mat-form-field class="border-input">
                      <input matInput type="text" placeholder="Rate" min="0" title="" [(ngModel)]="brand.tempRate"
                        appTwoDigitDecimaNumber (keyup)="valueChange(rfqSupplierDetailList)" />
                      <small *ngIf="!brand.validBrand" class="error-msg">Enter Valid Rate</small>
                    </mat-form-field>
                  </td>

                  <td class="text-align-right">{{ brand.brandRate * material.materialQuantity | number: "1.2-2" }}</td>

                  <td class="text-align-right">
                    <span *ngIf="!brand.brandRate">0.00</span>
                    <span
                      *ngIf="brand.brandRate">{{ (material.Igst / 100) * (brand.brandRate * material.materialQuantity) | number: "1.2-2" }}</span>
                  </td>
                </tr>
              </ng-container>
              <ng-template #intBHeader>

                <tr matSort class="brand-name-rfq-supplies">
                  <th class="font-size14">Brand Name</th>
                  <th class="font-size14">Unit Rate ({{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }})</th>
                  <th class="font-size14 text-align-right">Amount
                    ({{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }})</th>
                  <th class="font-size14 text-align-right">Tax Amount
                    ({{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }})
                    <span
                      *ngIf="taxAndCostData && taxAndCostData[projects.projectId] && taxAndCostData[projects.projectId][material.materialId] && taxAndCostData[projects.projectId][material.materialId].taxInfo && taxAndCostData[projects.projectId][material.materialId].taxInfo.length"
                      class="info-icon info-tootip"><img src="./../../../../assets/images/i_icon.png"
                        class="img-responsive">
                      <span class="info-tootip__content">
                        <div class="tooltip-table">
                          <p class="row mb-1"
                            *ngFor="let tInfo of taxAndCostData[projects.projectId][material.materialId].taxInfo">
                            <strong class="col">{{tInfo.taxName}}</strong><span class="col">{{tInfo.taxValue}}%</span>
                          </p>
                        </div>
                      </span>
                    </span>
                  </th>
                  <th class="font-size14 text-align-right">Total Amount
                    ({{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }})</th>
                </tr>

                <!-- Brand-wise details -->
                <tr class="table-white-background-color" *ngFor="let brand of material.rfqBrandList">
                  <td>{{ brand.brandName }}</td>

                  <td>
                    <mat-form-field class="border-input">
                      <input matInput type="text" placeholder="Rate" min="0" title="" [(ngModel)]="brand.tempRate"
                        appTwoDigitDecimaNumber (keyup)="valueChange(rfqSupplierDetailList)" />
                      <small *ngIf="!brand.validBrand" class="error-msg">Enter Valid Rate</small>
                    </mat-form-field>
                  </td>

                  <td class="text-align-right">{{ brand.brandRate * material.materialQuantity | number: "1.2-2" }}</td>

                  <td class="text-align-right">
                    <span
                      *ngIf="brand.brandRate && taxAndCostData && taxAndCostData[projects.projectId] && taxAndCostData[projects.projectId][material.materialId] && taxAndCostData[projects.projectId][material.materialId].taxInfo && taxAndCostData[projects.projectId][material.materialId].taxInfo.length; else wotaxInfo">
                      {{ ((brand.brandRate * material.materialQuantity) * getTaxInfototal(taxAndCostData[projects.projectId][material.materialId].taxInfo)) | number: "1.2-2" }}</span>
                    <ng-template #wotaxInfo>
                      <span>0.00</span>
                    </ng-template>
                  </td>

                  <td class="text-align-right">
                    <span
                      *ngIf="(brand.brandRate && taxAndCostData && taxAndCostData[projects.projectId] && taxAndCostData[projects.projectId][material.materialId] && taxAndCostData[projects.projectId][material.materialId].taxInfo && taxAndCostData[projects.projectId][material.materialId].taxInfo.length); else wotaxInfoTotal">
                      {{ ((brand.brandRate * material.materialQuantity) * getTaxInfototal(taxAndCostData[projects.projectId][material.materialId].taxInfo)) + (brand.brandRate * material.materialQuantity) | number: "1.2-2" }}</span>
                    <ng-template #wotaxInfoTotal>
                      <span *ngIf="!brand.brandRate">0.00</span>
                      <span
                        *ngIf="brand.brandRate">{{ brand.brandRate * material.materialQuantity | number: "1.2-2" }}</span>
                    </ng-template>
                  </td>
                </tr>

              </ng-template>
            </ng-container>
            <ng-container *ngIf="rfqSupplierDetailList.isInternational === 1">
              <tr class="material-rfq-supplies">
                <td></td>
                <td></td>
                <td></td>
                <td class="font-size14 pt-3">
                  <ng-container
                    *ngIf="otherCostData && otherCostData.otherCostInfo && otherCostData.otherCostInfo.length">
                    <strong>Other Cost: </strong>
                    <span style="margin-right:5px;">
                      {{ getotherCostInfoTotal(otherCostData.otherCostInfo) }}
                      {{ rfqSupplierDetailList.rfqCurrency.exchangeCurrencyName }}</span>
                    <span class="info-icon info-tootip"><img src="./../../../../assets/images/i_icon.png"
                        class="img-responsive">
                      <span class="info-tootip__content">
                        <div class="tooltip-table">
                          <p class="row mb-1" *ngFor="let otcost of otherCostData.otherCostInfo"> <strong
                              class="col">{{otcost.otherCostName}}</strong><span
                              class="col">{{otcost.otherCostAmount}}</span>
                          </p>
                        </div>
                      </span>
                    </span>
                  </ng-container>
                </td>
                <td class="text-align-right">
                  <button mat-button matRipple class="btn btn-link p-0 main-color text-decoration-underline"
                    (click)="openTaxesCostsDialog('otherCost')">Add other costs</button>
                </td>
              </tr>
            </ng-container>
          </table>
        </div>
      </div>
    </div>

    <div class="row width-100 p-t-10">
      <div class="col-md-4 col-sm-12">
        <app-rfq-bid-documents #rfqDocument [documentData]="documentList"></app-rfq-bid-documents>
      </div>
      <div class="col-md-8 col-sm-12">
        <div class="text-align-center font-size16 text-semi-bold">
          Comments
        </div>
        <form [formGroup]="rfqTerms">
          <angular-editor formControlName="textArea" [config]="config"></angular-editor>
          <!-- <textarea formControlName="textArea" [innerHTML]="rfqSupplierDetailList && rfqSupplierDetailList.comments" [froalaEditor]="froala" [(froalaModel)]="poTerms['textArea']">
Hello, Froala!</textarea -->
        </form>
      </div>
      <div class="col-md-12">
        <div class="word-wrap" *ngIf="rfqSupplierDetailList.comments && rfqSupplierDetailList.comments !== ''"
          [innerHTML]="rfqSupplierDetailList.comments"></div>
        <div class="center-element" *ngIf="rfqSupplierDetailList && rfqSupplierDetailList.comments == ''">No Comments To
          View</div>
      </div>
    </div>

    <div class="row width-100 p-t-10">
      <div class="col-lg-3"></div>
      <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div>
          <label for="bidCompletion" class="pull-left p-t-20 p-r-10">Bid Completion:</label>
          <span class="pull-left text-semi-bold m-t-20">{{ brandCount }}/{{ materialCount }}</span>
        </div>
        <div class="p-t-10 pull-right">
          <button mat-raised-button [disabled]="!submitButtonValidationFlag"
            class="main-background-color main-button color-white pull-right"
            (click)="postRFQDetailSupplier(rfqSupplierDetailList)">
            Next
          </button>
        </div>
      </div>
      <div class="col-lg-3"></div>
    </div>
  </div>
</div>