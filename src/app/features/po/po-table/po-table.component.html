<div class="row">
  <div class="col-xs-12 text-right m-t-10 m-b-5" *ngIf="mode === 'edit'">
    <mat-radio-group class="radio-btn-group-po-table p-r-20" aria-label="Select an option" [(ngModel)]="gst">
      <mat-radio-button [checked]="gst === 'IGST'" value="IGST" class="p-r-5">IGST</mat-radio-button>
      <mat-radio-button [checked]="gst === 'CGST & SGST'" value="CGST & SGST">CGST & SGST</mat-radio-button>
    </mat-radio-group>
  </div>
  <div class="col-xs-12 customPo">
    <form *ngIf="poTableData" [formGroup]="poForms" (ngSubmit)="sumbit()">
      <mat-accordion displayMode="flat" multi class="mat-table po-table" formArrayName="forms">
        <section matSort class="mat-elevation-z2 mat-header-row">
          <span class="mat-header-cell widthReduce" mat-sort-header="vesselName">S.No</span>
          <span class="mat-header-cell">Material Name</span>
          <span class="mat-header-cell">Makes</span>
          <span class="mat-header-cell">Fullfillment Date</span>
          <span class="mat-header-cell">Supplier Rate</span>
          <span class="mat-header-cell">Awarded quantity</span>
          <span class="mat-header-cell text-right p-r-10">Amount ₹</span>
          <span class="mat-header-cell text-center">GST %</span>
          <span class="mat-header-cell">GST Amount ₹</span>
          <span class="mat-header-cell">Total Amount with GST ₹</span>
        </section>
        <div *ngFor="let material of poTableData; let m = index" [formGroupName]="m">
          <div class="material-row">
            <span class="mat-cell widthReduce">{{ m + 1 }}</span>
            <span class="mat-cell">{{ material.materialName }}</span>
            <span class="mat-cell"></span>
            <span class="mat-cell">
              <ng-container *ngIf="mode != 'edit'; else editQuantity"> {{ material.fullfilmentDate | date: "dd-MMM-yyy" }}</ng-container>
              <ng-template #editQuantity>
                <mat-form-field class="border-input  date-label date-button mat-form-field-padding" style="width: 77%;">
                  <mat-label *ngIf="!inputDate.value">Select Date</mat-label>
                  <span class="form-placeholder">{{ poForms["controls"]["forms"]["controls"][m]["controls"]["fullfilmentDate"].value | date: "dd-MMM-yyy" }}</span>
                  <input
                    #inputDate
                    hidden
                    matInput
                    [matDatepicker]="dueDate"
                    formControlName="fullfilmentDate"
                    placeholde="Enter Date"
                    (focus)="dueDate.open()"
                    [min]="minDate"
                    readonly
                  />
                  <mat-datepicker-toggle matSuffix [for]="dueDate"></mat-datepicker-toggle>
                  <mat-datepicker #dueDate startView="month" [startAt]="dueDate"></mat-datepicker>
                </mat-form-field>
              </ng-template>
            </span>
            <span class="mat-cell"></span>
            <span class="mat-cell text-center">{{ getMaterialQuantity(m) | number: "1.2-2" }}</span>
            <span class="mat-cell text-right p-r-20">{{ getMaterialAmount(m) | number: "1.2-2" }}</span>
            <span class="mat-cell"></span>
            <span class="mat-cell">{{ getMaterialGstAmount(m) | number: "1.2-2" }}</span>
            <span class="mat-cell">{{ getMaterialTotalAmount(m) | number: "1.2-2" }}</span>
          </div>
          <ng-container formArrayName="purchaseOrderDetailList">
            <div class="mat-row" *ngFor="let purchaseOrder of material.purchaseOrderDetailList; let p = index" [formGroupName]="p">
              <span class="mat-cell widthReduce"></span>
              <span class=" mat-cell"></span>
              <span class="mat-cell">{{ purchaseOrder.materialBrand }}</span>
              <span class="mat-cell"></span>
              <span class="mat-cell">
                <ng-container *ngIf="mode != 'edit'; else editRate"> {{ purchaseOrder.materialUnitPrice }}</ng-container>
                <ng-template #editRate>
                  <mat-form-field class="border-input width50Percent">
                    <input
                      type="number"
                      matInput
                      #rate
                      formControlName="materialUnitPrice"
                      placeholder="rate"
                      min="0"
                    />
                      <small *ngIf="poForms['controls']['forms']['controls'][m]['controls']['purchaseOrderDetailList']['controls'][p]['controls']['materialUnitPrice'].hasError('pattern') && poForms['controls']['forms']['controls'][m]['controls']['purchaseOrderDetailList']['controls'][p]['controls']['materialUnitPrice'].touched" class="error-msg"> Invalid rate </small>
                      <!-- controls.forms.controls[""0""].controls.purchaseOrderDetailList.controls[""0""].controls.materialUnitPrice -->
                  </mat-form-field>
                </ng-template>
              </span>
              <span class="mat-cell  text-center">
                <ng-container *ngIf="mode != 'edit'; else editQuantity"> {{ purchaseOrder.materialQuantity }}</ng-container>
                <ng-template #editQuantity>
                  <mat-form-field class="border-input width50Percent">
                    <input
                      type="number"
                      matInput
                      #quantity
                      formControlName="materialQuantity"
                      placeholder="quantity"
                      min="0"
                      onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                    />
                  </mat-form-field>
                </ng-template>
              </span>
              <span class="mat-cell text-right p-r-20">
                <ng-container *ngIf="mode != 'edit'; else editAmount">{{ purchaseOrder.amount }} </ng-container>
                <ng-template #editAmount>
                  {{ poForms["controls"]["forms"]["controls"][m]["controls"]["purchaseOrderDetailList"]["controls"][p]["controls"]["amount"].value | number: "1.2-2" }}
                </ng-template>
              </span>
              <span class="mat-cell text-center">
                <span *ngIf="mode != 'edit'; else editGst">
                  <span *ngIf="purchaseOrder && purchaseOrder.materialCgst == 0 && purchaseOrder.materialSgst === 0">
                    {{ purchaseOrder.materialIgst }}
                  </span>
                  <span *ngIf="purchaseOrder && purchaseOrder.materialCgst != 0 && purchaseOrder.materialSgst != 0">
                    {{ purchaseOrder.materialCgst + purchaseOrder.materialSgst }}
                  </span>
                </span>
                <ng-template #editGst>
                  <mat-form-field class="border-input width50Percent">
                    <input
                      matInput
                      type="number"
                      #gst
                      formControlName="gst"
                      placeholder="GST%"
                      class="m-r-5"
                      min="0"
                    />
                     <small *ngIf="poForms['controls']['forms']['controls'][m]['controls']['purchaseOrderDetailList']['controls'][p]['controls']['gst'].hasError('pattern') && poForms['controls']['forms']['controls'][m]['controls']['purchaseOrderDetailList']['controls'][p]['controls']['gst'].touched" class="error-msg"> Invalid gst </small>
                  </mat-form-field>
                </ng-template>
              </span>
              <span class="mat-cell ">
                <ng-container *ngIf="mode != 'edit'; else editgstAmount">{{ purchaseOrder.gstAmount | number: "1.2-2" }} </ng-container>
                <ng-template #editgstAmount>
                  {{ poForms["controls"]["forms"]["controls"][m]["controls"]["purchaseOrderDetailList"]["controls"][p]["controls"]["gstAmount"].value | number: "1.2-2" }}
                </ng-template>
              </span>
              <span class="mat-cell">
                <ng-container *ngIf="mode != 'edit'; else editTotal">{{ purchaseOrder.total }} </ng-container>
                <ng-template #editTotal>
                  {{ poForms["controls"]["forms"]["controls"][m]["controls"]["purchaseOrderDetailList"]["controls"][p]["controls"]["total"].value | number: "1.2-2" }}
                </ng-template>
              </span>
            </div>
          </ng-container>
        </div>
        <div class="mat-row footer">
          <span class="mat-cell widthReduce"></span>
          <span class=" mat-cell"></span>
          <span class="mat-cell"></span>
          <span class="mat-cell"></span>
          <span class="mat-cell"></span>
          <span class="mat-cell"></span>
          <span class="mat-cell"></span>
          <span class="mat-cell"><span>GST Amount ₹</span> <br />{{ gstTotalAmount | number: "1.2-2" }}</span>
          <span class="mat-cell"><span>Total Amount ₹</span> <br />{{ totalAmount | number: "1.2-2" }}</span>
        </div>
        <div class="col-xs-12 text-right text-semi-bold m-t-10 p-r-35">
          Net Payable Amount in Words :Rupees {{ totalAmount | numberToWords | async | titlecase }} <span class="text-semi-bold">Only /-</span>
        </div>
      </mat-accordion>
    </form>
  </div>
</div>
